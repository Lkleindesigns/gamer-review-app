<% include ../partials/header %>
<div class="container">
  <div class="row">
    <div class="col-md-3">
      <p class="lead">GamerReviews</p>
      <div class="list-grou">
        <li class="list-group-item active">Info 1</li>
        <li class="list-group-item">Info 2</li>
        <li class="list-group-item">Info 3</li>
      </div>
      MAP
    </div>
    <div class='col-md-9'>
      <div class="thumbnail">
        <img class="img-responsive" src="<%= game.image %>">
        <div class="caption-full">
          <h4 class="pull-right"><%=game.genre%></h4>
          <h4><a><%= game.name %></a></h4>
          <p><%= game.description %></p>
        </div>
      </div>
      <div class="well">
        <div class="text-right">
            <a class="btn btn-success" href="/games/<%=game._id%>/reviews/new">Add new review!</a>
        </div>
        <div class="row">
          <div class="genre-lists col-md-12">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(() => {
    $.getJSON("/api/traits/<%= game._id %>")
    .then(addTraits)
  })

  function addTraits(traitsObj) {
    $.each(traitsObj, (key) => {
      var hr = $('<hr></hr>')
      var newTraitHeader = $('<div style="display: block;">' + key + '</div>')
      var newTraitList = $('<div class="trait-list" style="padding: 0; list-style-type: none;"></div>')

      $('.genre-lists').append(newTraitHeader)
      $(newTraitHeader).append(newTraitList)
      $(newTraitHeader).append(hr)

      traitsObj[key].forEach((genreTrait) => {
        addTrait(genreTrait, newTraitList)
      })
    })
  }

  function addTrait(trait, tList) {
    var newTrait = $('<span class="trait" style="display: block;">' + trait.name + '</span>')
    newTrait.data('id', trait._id)
    $(tList).append(newTrait)
    upvoteTrait(newTrait)
  }

  function upvoteTrait(trait) {
    $(trait).on('click', () => {
      var traitId = $(this).data('id')
      var putUrl = '/api/traits/' + traitId + '/upvote'
      $.ajax({
        method: 'PUT',
        url: putUrl
      })
      .then((data) => {
        console.log(data)
      })
    })
  }
</script>

<% include ../partials/footer %>

